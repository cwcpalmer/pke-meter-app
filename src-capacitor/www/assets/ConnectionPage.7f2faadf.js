import{u as Q,a as A,Q as p}from"./QBtn.fa306d7e.js";import{c as V,d as G,X as k,_ as L,Y as h,Z as N,T as $,r as g,D as K,o as U,G as u,H as m,I as D,J as b,K as y,$ as O,a0 as R,M as S,a1 as F,a2 as r}from"./index.b250a799.js";import{Q as H}from"./QRadio.d7657fdc.js";import{Q as W}from"./QPage.a495d58e.js";import{g as P}from"./gathered-phone-data-store.805732d0.js";import"./Ripple.12fe2598.js";const Y='<g transform="translate(-20,-20)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="90 50 50" to="0 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g><g transform="translate(20,20) rotate(15 50 50)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="90 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g>';var q=V({name:"QSpinnerGears",props:Q,setup(c){const{cSize:i,classes:s}=A(c);return()=>G("svg",{class:s.value,width:i.value,height:i.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg",innerHTML:Y})}});const J=k("Geolocation",{web:()=>L(()=>import("./web.57a7faa7.js"),["assets/web.57a7faa7.js","assets/index.b250a799.js","assets/index.7e71c84c.css"]).then(c=>new c.GeolocationWeb)}),v=P(),C=h(),f=N(),X=$("parseStore",{state:()=>({}),actions:{async parseData(c){const i=c.getUint8(0);let s=1,t=await J.getCurrentPosition();if(v.lastLocation={latitude:t.coords.latitude,longitude:t.coords.longitude},v.lastTimeStamp=t.timestamp,i&1){let a=c.getFloat32(s,!0);a=Math.round((a+Number.EPSILON)*100)/100,s+=4,v.temp=a,await C.dataInsertion(t.timestamp,t.coords.latitude,t.coords.longitude,1,a,f.connectedDeviceID,f.connectedDeviceName)}if(i&2){let a=c.getFloat32(s,!0);a=Math.round((a+Number.EPSILON)*100)/100,s+=4,v.temp2=a,await C.dataInsertion(t.timestamp,t.coords.latitude,t.coords.longitude,2,a,f.connectedDeviceID,f.connectedDeviceName)}}}}),I=k("KeepAwake",{web:()=>L(()=>import("./web.2e7ad294.js"),["assets/web.2e7ad294.js","assets/index.b250a799.js","assets/index.7e71c84c.css"]).then(c=>new c.KeepAwakeWeb)}),oe={__name:"ConnectionPage",setup(c){const i=g(!1);let s=K([]);const t=g({});let a=null;const e=N(),d=P();g({});const T=h(),_=X(),w=async()=>{await r.stopLEScan(),i.value=!1};U(async()=>{await T.openDatabase()});const M=async()=>{try{i.value=!0,s.length=0,await r.initialize(),await r.requestLEScan({namePrefix:"PKE Meter"},o=>{s.push(o)}),a=setTimeout(async()=>{a=null,await w()},5e3)}catch(o){console.log(o)}},z=async()=>{a&&(clearTimeout(a),await w())},B=async()=>{await r.connect(t.value.device.deviceId,async o=>{e.isConnected=!1,e.connectedDeviceID="",e.connectedDeviceName="",d.reset(),await I.allowSleep()}),e.connectedDeviceID=t.value.device.deviceId,e.connectedDeviceName=t.value.device.name,await r.getServices(e.connectedDeviceID),e.isConnected=!0,await I.keepAwake(),await r.startNotifications(e.connectedDeviceID,e.serviceSensors,e.characteristicSensors,o=>{_.parseData(o)}),await r.startNotifications(e.connectedDeviceID,e.serviceBattery,e.characteristicBatteryLevel,o=>{d.battery=o.getUint8(0),o.getUint8(0)>=75?d.batteryIcon="battery_full":o.getUint8(0)>=25?d.batteryIcon="battery_3_bar":d.batteryIcon="battery_alert"})},E=async()=>{await r.stopNotifications(e.connectedDeviceID,e.serviceSensors,e.characteristicSensors),await r.disconnect(e.connectedDeviceID)};return(o,n)=>(u(),m(W,null,{default:D(()=>[b(p,{color:"primary",icon:"bluetooth",size:"lg",onClick:n[0]||(n[0]=l=>M()),disable:i.value,loading:i.value,style:{display:"block",width:"100%"}},{loading:D(()=>[b(q,{class:"on-left"}),n[5]||(n[5]=y(" Scanning... "))]),default:D(()=>[n[6]||(n[6]=y(" Scan Devices "))]),_:1},8,["disable","loading"]),(u(!0),O(F,null,R(S(s),l=>(u(),m(H,{onClick:z,modelValue:t.value,"onUpdate:modelValue":n[1]||(n[1]=x=>t.value=x),key:l.device.deviceId,val:l,label:l.device.name+" ("+l.device.deviceId+")"},null,8,["modelValue","val","label"]))),128)),S(e).isConnected?(u(),m(p,{key:1,onClick:n[3]||(n[3]=l=>E()),color:"red",icon:"bluetooth",size:"lg",label:"Disconnect",style:{display:"block",width:"100%"}})):(u(),m(p,{key:0,onClick:n[2]||(n[2]=l=>B()),color:"primary",icon:"bluetooth",size:"lg",label:"Connect",style:{display:"block",width:"100%"}})),b(p,{color:"negative",icon:"arrow_back",size:"lg",label:"Back",onClick:n[4]||(n[4]=l=>{o.$router.push("/")}),style:{display:"block",width:"100%"}})]),_:1}))}};export{oe as default};
